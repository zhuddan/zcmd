import { Body, Controller, Delete, Get, Param, ParseIntPipe, Patch, Post, Query } from '@nestjs/common'
import { Permission } from '@/libs/common/src/auth/decorators/permission.decorator'
import { CursorPageDto } from '@/libs/common/src/dto/cursor-page.dto.ts'
import { CommonResult } from '@/libs/common/src/utils/common-result'
import { Create<%= upperCamelCase %>Dto } from './dto/create-<%= moduleName %>.dto'
import { <%= upperCamelCase %>PageDto } from './dto/<%= moduleName %>-page.dto'
import { Update<%= upperCamelCase %>Dto } from './dto/update-<%= moduleName %>.dto'
import { <%= upperCamelCase %>Service } from './<%= moduleName %>.service'

/**
 * <%= moduleNameCN %>管理
 */
@Controller('<%= moduleName %>')
export class <%= upperCamelCase %>Controller {
  constructor(private readonly <%= lowerCamelCase %>Service: <%= upperCamelCase %>Service) {}

  /**
   * 创建<%= moduleNameCN %>
   */
  @Permission('<%= moduleName %>.create')
  @Post('create')
  async create(@Body() create<%= upperCamelCase %>Dto: Create<%= upperCamelCase %>Dto) {
    return CommonResult.success(await this.<%= lowerCamelCase %>Service.create(create<%= upperCamelCase %>Dto))
  }

  /**
   * 获取所有<%= moduleNameCN %>
   */
  @Permission('<%= moduleName %>.all')
  @Get('all')
  async findAll() {
    return CommonResult.success(await this.<%= lowerCamelCase %>Service.findAll())
  }

  /**
   * <%= moduleNameCN %>分页列表
   */
  @Permission('<%= moduleName %>.list')
  @Get('list')
  async page(@Query() <%= lowerCamelCase %>PageDto: <%= upperCamelCase %>PageDto) {
    return CommonResult.success(await this.<%= lowerCamelCase %>Service.paginate(<%= lowerCamelCase %>PageDto))
  }


  /**
   *  <%= moduleNameCN %>树形结构
   */
  @Permission('<%= moduleName %>.tree')
  @Get('tree')
  async findTree() {
    return CommonResult.success(await this.<%= lowerCamelCase %>Service.findTree())
  }


  /**
   * <%= moduleNameCN %>游标分页
   */
  @Permission('<%= moduleName %>.cursor')
  @Get('cursor')
  async cursor(@Query() cursorPageDto: CursorPageDto) {
    return CommonResult.success(await this.<%= lowerCamelCase %>Service.cursorPaginate(cursorPageDto))
  }

  /**
   * <%= moduleNameCN %>详情
   */
  @Permission('<%= moduleName %>.detail')
  @Get('detail/:id')
  async findOne(@Param('id', ParseIntPipe) id: number) {
    return CommonResult.success(await this.<%= lowerCamelCase %>Service.findOne(id))
  }

  /**
   * 更新<%= moduleNameCN %>
   */
  @Permission('<%= moduleName %>.update')
  @Patch('update/:id')
  async update(@Param('id', ParseIntPipe) id: number, @Body() update<%= upperCamelCase %>Dto: Update<%= upperCamelCase %>Dto) {
    await this.<%= lowerCamelCase %>Service.update(id, update<%= upperCamelCase %>Dto)
    return CommonResult.success()
  }

  /**
   * 删除<%= moduleNameCN %>
   */
  @Permission('<%= moduleName %>.delete')
  @Delete('remove/:id')
  async remove(@Param('id', ParseIntPipe) id: number) {
    await this.<%= lowerCamelCase %>Service.remove(+id)
    return CommonResult.success()
  }
}
